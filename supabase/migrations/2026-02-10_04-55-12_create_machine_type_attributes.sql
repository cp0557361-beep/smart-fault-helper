-- Create table for machine type attribute definitions\nCREATE TABLE public.machine_type_attribute_definitions (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  machine_type_id UUID NOT NULL REFERENCES public.machine_types(id) ON DELETE CASCADE,\n  attribute_name TEXT NOT NULL,\n  attribute_type TEXT NOT NULL DEFAULT 'text',\n  options JSONB DEFAULT NULL,\n  sequence_order INTEGER DEFAULT 0,\n  is_required BOOLEAN DEFAULT false,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(machine_type_id, attribute_name)\n);\n\n-- Create table for machine type attribute values (instance values per machine)\nCREATE TABLE public.machine_type_attribute_values (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  machine_id UUID NOT NULL REFERENCES public.machines(id) ON DELETE CASCADE,\n  attribute_definition_id UUID REFERENCES public.machine_type_attribute_definitions(id) ON DELETE CASCADE,\n  attribute_name TEXT NOT NULL,\n  attribute_value TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(machine_id, attribute_name)\n);\n\n-- Enable RLS\nALTER TABLE public.machine_type_attribute_definitions ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.machine_type_attribute_values ENABLE ROW LEVEL SECURITY;\n\n-- RLS policies for machine_type_attribute_definitions\nCREATE POLICY "Authenticated users can view machine type attribute definitions"\nON public.machine_type_attribute_definitions\nFOR SELECT\nUSING (true);\n\nCREATE POLICY "Only admins can insert machine type attribute definitions"\nON public.machine_type_attribute_definitions\nFOR INSERT\nWITH CHECK (is_admin());\n\nCREATE POLICY "Only admins can update machine type attribute definitions"\nON public.machine_type_attribute_definitions\nFOR UPDATE\nUSING (is_admin());\n\nCREATE POLICY "Only admins can delete machine type attribute definitions"\nON public.machine_type_attribute_definitions\nFOR DELETE\nUSING (is_admin());\n\n-- RLS policies for machine_type_attribute_values\nCREATE POLICY "Authenticated users can view machine type attribute values"\nON public.machine_type_attribute_values\nFOR SELECT\nUSING (true);\n\nCREATE POLICY "Only admins can insert machine type attribute values"\nON public.machine_type_attribute_values\nFOR INSERT\nWITH CHECK (is_admin());\n\nCREATE POLICY "Only admins can update machine type attribute values"\nON public.machine_type_attribute_values\nFOR UPDATE\nUSING (is_admin());\n\nCREATE POLICY "Only admins can delete machine type attribute values"\nON public.machine_type_attribute_values\nFOR DELETE\nUSING (is_admin());\n\n-- Triggers for updated_at\nCREATE TRIGGER update_machine_type_attribute_definitions_updated_at\nBEFORE UPDATE ON public.machine_type_attribute_definitions\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_machine_type_attribute_values_updated_at\nBEFORE UPDATE ON public.machine_type_attribute_values\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n