-- Migration for machine type attribute definitions and values tables\n\n-- Create table: machine_type_attribute_definitions\nCREATE TABLE machine_type_attribute_definitions (\n    id SERIAL PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    description TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    CONSTRAINT unique_name UNIQUE (name)\n);\n\n-- Create table: machine_type_attribute_values\nCREATE TABLE machine_type_attribute_values (\n    id SERIAL PRIMARY KEY,\n    definition_id INT REFERENCES machine_type_attribute_definitions(id) ON DELETE CASCADE,\n    value VARCHAR(255) NOT NULL,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    CONSTRAINT unique_definition_value UNIQUE (definition_id, value)\n);\n\n-- Enable Row Level Security\nALTER TABLE machine_type_attribute_definitions ENABLE ROW LEVEL SECURITY;\nALTER TABLE machine_type_attribute_values ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS Policies\nCREATE POLICY select_machine_type_attribute_definitions ON machine_type_attribute_definitions\n    FOR SELECT\n    USING (true);  -- Allowing all users to read\n\nCREATE POLICY insert_machine_type_attribute_definitions ON machine_type_attribute_definitions\n    FOR INSERT\n    WITH CHECK (auth.uid() IS NOT NULL);  -- Allowing only authenticated users to insert\n\nCREATE POLICY select_machine_type_attribute_values ON machine_type_attribute_values\n    FOR SELECT\n    USING (true);  -- Allowing all users to read\n\nCREATE POLICY insert_machine_type_attribute_values ON machine_type_attribute_values\n    FOR INSERT\n    WITH CHECK (auth.uid() IS NOT NULL);  -- Allowing only authenticated users to insert\n\n-- Create triggers for update timestamps\nCREATE OR REPLACE FUNCTION update_timestamps()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = NOW();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER update_definition_timestamps\nBEFORE UPDATE ON machine_type_attribute_definitions\nFOR EACH ROW\nEXECUTE FUNCTION update_timestamps();\n\nCREATE TRIGGER update_value_timestamps\nBEFORE UPDATE ON machine_type_attribute_values\nFOR EACH ROW\nEXECUTE FUNCTION update_timestamps();\n